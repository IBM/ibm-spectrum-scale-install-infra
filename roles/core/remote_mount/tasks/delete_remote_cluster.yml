---
- name: Client Cluster (access) | DELETE The remotecluster {{ owning_cluster_name }} ...
  uri:
    validate_certs: no
    force_basic_auth: true
    url: https://{{ client_cluster_gui_hostname }}:{{ client_cluster_gui_port }}/{{ remote_mount_endpoint }}/owningclusters/{{ owning_cluster_name }}
    method: DELETE
    user: "{{ client_cluster_gui_username }}"
    password: "{{ client_cluster_gui_password }}"
    status_code:
      - 202
  register: delete_call

- name: Client Cluster (access) | Check the results from the DELETE
  uri:
    validate_certs: no
    force_basic_auth: true
    url: https://{{ client_cluster_gui_hostname }}:{{ client_cluster_gui_port }}/{{ scalemgmt_endpoint }}/jobs/{{ delete_call.json.jobs[0].jobId }}
    method: GET
    user: "{{ client_cluster_gui_username }}"
    password: "{{ client_cluster_gui_password }}"
  register: completed_check
  until: completed_check.json.jobs[0].status == "COMPLETED"
  retries: "{{ restapi_retries_count }}"
  delay: "{{ restapi_retries_delay }}"
